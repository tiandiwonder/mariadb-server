include/master-slave.inc
[connection master]
connection slave;
stop slave;
change master to master_use_gtid= current_pos;
Warnings:
Warning	1287	'master_use_gtid=current_pos' is deprecated and will be removed in a future release. Please use master_demote_to_slave=1 instead
SET GLOBAL slave_parallel_threads=4;
set global slave_parallel_mode=optimistic;
set global gtid_strict_mode=1;
start slave;
connection master;
set binlog_alter_two_phase=true;
create table t1(a int , b int) engine=innodb;
create table a1(a int , b int) engine=myisam;
create temporary table tmp_tbl(a int, b int) engine=innodb;
alter table t1 add column if not exists c int ,  algorithm=default;
alter table t1 add column d int first,  algorithm=default;
alter table t1 add column e int after c,  algorithm=default;
alter table t1 add column f int after c,  add column g int first ,add column  h char, algorithm=default;
alter table t1 drop column c, drop column d, drop column e, drop column f, drop column g , drop column h,  algorithm=default;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f int after b,  add column g int first ,add column  h varchar(100), algorithm=default;
alter table t1 add index if not exists index_1(f),  algorithm=default;
alter table t1 drop index index_1,  algorithm=default;
alter table t1 add unique key unique_1(g),  algorithm=default;
alter table t1 drop index unique_1,  algorithm=default;
alter table t1 add fulltext  key f_1(h),  algorithm=default;
alter table t1  drop column f, drop column g ,  algorithm=default;
alter table t1 add primary key(h),  algorithm=copy;
alter table t1 drop primary key,  algorithm=copy;
alter table t1  drop column h,  algorithm=copy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b, add column g varchar(100) first ,add column  h char,  algorithm=default;
alter table t1 add period for system_time(f,h);
alter table t1 add system versioning;
alter table t1 drop system versioning;
alter table t1  drop column f, drop column g , drop column h,  algorithm=default;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=default ;;
alter table t1 alter column f set default "****",  algorithm=default ;;
alter table t1 alter column f drop default,  algorithm=default ;;
alter table t1 change column g new_g char,  algorithm=copy;;
alter table t1 modify column h varchar(100),  algorithm=copy;;
alter table t1 drop column new_g ,drop column f, drop column h,  algorithm=default ;;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=default;
alter table t1 add index if not exists index_1(f),  algorithm=default;
alter table t1 disable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 enable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 rename t2,  algorithm=default;
alter table t2 rename t1,  algorithm=default;
alter table a1 order by a;
alter table t1 rename column f to new_f,  algorithm=copy;
alter table t1 convert to character set 'utf8',  algorithm=copy;
alter table t1 default character set 'utf8',  algorithm=copy;
alter table t1 default collate 'utf8_icelandic_ci',  algorithm=copy;
alter table t1 drop column new_f ,drop column g, drop column h,  algorithm=default;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=default;
alter table t1  partition  by hash(b) partitions 8;
alter table t1  remove partitioning;
alter table t1 drop column f ,drop column g, drop column h,  algorithm=default;
# show binlog and clear status
connection slave;
reset master;
connection master;
connection master;
drop table t1, a1;
drop temporary table tmp_tbl;
connection slave;
include/stop_slave.inc
set global slave_parallel_threads = 0;;
set global slave_parallel_mode = optimistic;;
set global gtid_strict_mode = 0;;
include/start_slave.inc
connection slave;
stop slave;
change master to master_use_gtid= current_pos;
Warnings:
Warning	1287	'master_use_gtid=current_pos' is deprecated and will be removed in a future release. Please use master_demote_to_slave=1 instead
SET GLOBAL slave_parallel_threads=4;
set global slave_parallel_mode=optimistic;
set global gtid_strict_mode=1;
start slave;
connection master;
set binlog_alter_two_phase=true;
create table t1(a int , b int) engine=innodb;
create table a1(a int , b int) engine=myisam;
create temporary table tmp_tbl(a int, b int) engine=innodb;
alter table t1 add column if not exists c int ,  algorithm=inplace;
alter table t1 add column d int first,  algorithm=inplace;
alter table t1 add column e int after c,  algorithm=inplace;
alter table t1 add column f int after c,  add column g int first ,add column  h char, algorithm=inplace;
alter table t1 drop column c, drop column d, drop column e, drop column f, drop column g , drop column h,  algorithm=inplace;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f int after b,  add column g int first ,add column  h varchar(100), algorithm=inplace;
alter table t1 add index if not exists index_1(f),  algorithm=inplace;
alter table t1 drop index index_1,  algorithm=inplace;
alter table t1 add unique key unique_1(g),  algorithm=inplace;
alter table t1 drop index unique_1,  algorithm=inplace;
alter table t1 add fulltext  key f_1(h),  algorithm=inplace;
alter table t1  drop column f, drop column g ,  algorithm=inplace;
alter table t1 add primary key(h),  algorithm=copy;
alter table t1 drop primary key,  algorithm=copy;
alter table t1  drop column h,  algorithm=copy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b, add column g varchar(100) first ,add column  h char,  algorithm=inplace;
alter table t1 add period for system_time(f,h);
alter table t1 add system versioning;
alter table t1 drop system versioning;
alter table t1  drop column f, drop column g , drop column h,  algorithm=inplace;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=inplace ;;
alter table t1 alter column f set default "****",  algorithm=inplace ;;
alter table t1 alter column f drop default,  algorithm=inplace ;;
alter table t1 change column g new_g char,  algorithm=copy;;
alter table t1 modify column h varchar(100),  algorithm=copy;;
alter table t1 drop column new_g ,drop column f, drop column h,  algorithm=inplace ;;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=inplace;
alter table t1 add index if not exists index_1(f),  algorithm=inplace;
alter table t1 disable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 enable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 rename t2,  algorithm=inplace;
alter table t2 rename t1,  algorithm=inplace;
alter table a1 order by a;
alter table t1 rename column f to new_f,  algorithm=copy;
alter table t1 convert to character set 'utf8',  algorithm=copy;
alter table t1 default character set 'utf8',  algorithm=copy;
alter table t1 default collate 'utf8_icelandic_ci',  algorithm=copy;
alter table t1 drop column new_f ,drop column g, drop column h,  algorithm=inplace;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=inplace;
alter table t1  partition  by hash(b) partitions 8;
alter table t1  remove partitioning;
alter table t1 drop column f ,drop column g, drop column h,  algorithm=inplace;
# show binlog and clear status
connection slave;
reset master;
connection master;
connection master;
drop table t1, a1;
drop temporary table tmp_tbl;
connection slave;
include/stop_slave.inc
set global slave_parallel_threads = 0;;
set global slave_parallel_mode = optimistic;;
set global gtid_strict_mode = 0;;
include/start_slave.inc
connection slave;
stop slave;
change master to master_use_gtid= current_pos;
Warnings:
Warning	1287	'master_use_gtid=current_pos' is deprecated and will be removed in a future release. Please use master_demote_to_slave=1 instead
SET GLOBAL slave_parallel_threads=4;
set global slave_parallel_mode=optimistic;
set global gtid_strict_mode=1;
start slave;
connection master;
set binlog_alter_two_phase=true;
create table t1(a int , b int) engine=innodb;
create table a1(a int , b int) engine=myisam;
create temporary table tmp_tbl(a int, b int) engine=innodb;
alter table t1 add column if not exists c int ,  algorithm=copy;
alter table t1 add column d int first,  algorithm=copy;
alter table t1 add column e int after c,  algorithm=copy;
alter table t1 add column f int after c,  add column g int first ,add column  h char, algorithm=copy;
alter table t1 drop column c, drop column d, drop column e, drop column f, drop column g , drop column h,  algorithm=copy;
alter table tmp_tbl add column if not exists c int ,  algorithm=copy;
alter table tmp_tbl add column d int first,  algorithm=copy;
alter table tmp_tbl add column e int after c,  algorithm=copy;
alter table tmp_tbl add column f int after c,  add column g int first ,add column  h char, algorithm=copy;
alter table tmp_tbl drop column c, drop column d, drop column e, drop column f, drop column g , drop column h,  algorithm=copy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f int after b,  add column g int first ,add column  h varchar(100), algorithm=copy;
alter table t1 add index if not exists index_1(f),  algorithm=copy;
alter table t1 drop index index_1,  algorithm=copy;
alter table t1 add unique key unique_1(g),  algorithm=copy;
alter table t1 drop index unique_1,  algorithm=copy;
alter table t1 add fulltext  key f_1(h),  algorithm=copy;
alter table t1  drop column f, drop column g ,  algorithm=copy;
alter table tmp_tbl add column f int after b,  add column g int first ,add column  h varchar(100), algorithm=copy;
alter table tmp_tbl add index if not exists index_1(f),  algorithm=copy;
alter table tmp_tbl drop index index_1,  algorithm=copy;
alter table tmp_tbl add unique key unique_1(g),  algorithm=copy;
alter table tmp_tbl drop index unique_1,  algorithm=copy;
alter table tmp_tbl drop column f, drop column g ,  algorithm=copy;
alter table t1 add primary key(h),  algorithm=copy;
alter table t1 drop primary key,  algorithm=copy;
alter table t1  drop column h,  algorithm=copy;
alter table tmp_tbl add primary key(h),  algorithm=copy;
alter table tmp_tbl drop primary key,  algorithm=copy;
alter table tmp_tbl  drop column h,  algorithm=copy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b, add column g varchar(100) first ,add column  h char,  algorithm=copy;
alter table t1 add period for system_time(f,h);
alter table t1 add system versioning;
alter table t1 drop system versioning;
alter table t1  drop column f, drop column g , drop column h,  algorithm=copy;
# show binlog and clear status
alter table tmp_tbl add column f varchar(100) after b, add column g varchar(100) first ,add column  h char,  algorithm=copy;
alter table tmp_tbl drop column f, drop column g , drop column h,  algorithm=copy;
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=copy ;;
alter table t1 alter column f set default "****",  algorithm=copy ;;
alter table t1 alter column f drop default,  algorithm=copy ;;
alter table t1 change column g new_g char,  algorithm=copy;;
alter table t1 modify column h varchar(100),  algorithm=copy;;
alter table t1 drop column new_g ,drop column f, drop column h,  algorithm=copy ;;
alter table tmp_tbl add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=copy ;;
alter table tmp_tbl alter column f set default "****",  algorithm=copy ;;
alter table tmp_tbl alter column f drop default,  algorithm=copy ;;
alter table tmp_tbl change column g new_g char,  algorithm=copy;;
alter table tmp_tbl modify column h varchar(100),  algorithm=copy;;
alter table tmp_tbl drop column new_g ,drop column f, drop column h,  algorithm=copy ;;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=copy;
alter table t1 add index if not exists index_1(f),  algorithm=copy;
alter table t1 disable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 enable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 rename t2,  algorithm=copy;
alter table t2 rename t1,  algorithm=copy;
alter table a1 order by a;
alter table t1 rename column f to new_f,  algorithm=copy;
alter table t1 convert to character set 'utf8',  algorithm=copy;
alter table t1 default character set 'utf8',  algorithm=copy;
alter table t1 default collate 'utf8_icelandic_ci',  algorithm=copy;
alter table t1 drop column new_f ,drop column g, drop column h,  algorithm=copy;
alter table tmp_tbl add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=copy;
alter table tmp_tbl add index if not exists index_1(f),  algorithm=copy;
alter table tmp_tbl disable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`tmp_tbl` doesn't have this option
alter table tmp_tbl enable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`tmp_tbl` doesn't have this option
alter table a1 order by a;
alter table tmp_tbl rename column f to new_f,  algorithm=copy;
alter table tmp_tbl convert to character set 'utf8',  algorithm=copy;
alter table tmp_tbl default character set 'utf8',  algorithm=copy;
alter table tmp_tbl default collate 'utf8_icelandic_ci',  algorithm=copy;
alter table tmp_tbl drop column new_f ,drop column g, drop column h,  algorithm=copy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=copy;
alter table t1  partition  by hash(b) partitions 8;
alter table t1  remove partitioning;
alter table t1 drop column f ,drop column g, drop column h,  algorithm=copy;
alter table tmp_tbl add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=copy;
alter table tmp_tbl drop column f ,drop column g, drop column h,  algorithm=copy;
# show binlog and clear status
connection slave;
reset master;
connection master;
connection master;
drop table t1, a1;
drop temporary table tmp_tbl;
connection slave;
include/stop_slave.inc
set global slave_parallel_threads = 0;;
set global slave_parallel_mode = optimistic;;
set global gtid_strict_mode = 0;;
include/start_slave.inc
# Prove formal support for nocopy and instant
connection slave;
stop slave;
change master to master_use_gtid= current_pos;
Warnings:
Warning	1287	'master_use_gtid=current_pos' is deprecated and will be removed in a future release. Please use master_demote_to_slave=1 instead
SET GLOBAL slave_parallel_threads=4;
set global slave_parallel_mode=optimistic;
set global gtid_strict_mode=1;
start slave;
connection master;
set binlog_alter_two_phase=true;
create table t1(a int , b int) engine=innodb;
create table a1(a int , b int) engine=myisam;
create temporary table tmp_tbl(a int, b int) engine=innodb;
alter table t1 add column if not exists c int ,  algorithm=instant;
alter table t1 add column d int first,  algorithm=instant;
alter table t1 add column e int after c,  algorithm=instant;
alter table t1 add column f int after c,  add column g int first ,add column  h char, algorithm=instant;
alter table t1 drop column c, drop column d, drop column e, drop column f, drop column g , drop column h,  algorithm=instant;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f int after b,  add column g int first ,add column  h varchar(100), algorithm=instant;
alter table t1 add index if not exists index_1(f),  algorithm=instant;
alter table t1 drop index index_1,  algorithm=instant;
alter table t1 add unique key unique_1(g),  algorithm=instant;
alter table t1 drop index unique_1,  algorithm=instant;
alter table t1 add fulltext  key f_1(h),  algorithm=instant;
alter table t1  drop column f, drop column g ,  algorithm=instant;
alter table t1 add primary key(h),  algorithm=copy;
alter table t1 drop primary key,  algorithm=copy;
alter table t1  drop column h,  algorithm=copy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b, add column g varchar(100) first ,add column  h char,  algorithm=instant;
alter table t1 add period for system_time(f,h);
alter table t1 add system versioning;
alter table t1 drop system versioning;
alter table t1  drop column f, drop column g , drop column h,  algorithm=instant;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=instant ;;
alter table t1 alter column f set default "****",  algorithm=instant ;;
alter table t1 alter column f drop default,  algorithm=instant ;;
alter table t1 change column g new_g char,  algorithm=copy;;
alter table t1 modify column h varchar(100),  algorithm=copy;;
alter table t1 drop column new_g ,drop column f, drop column h,  algorithm=instant ;;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=instant;
alter table t1 add index if not exists index_1(f),  algorithm=instant;
alter table t1 disable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 enable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 rename t2,  algorithm=instant;
alter table t2 rename t1,  algorithm=instant;
alter table a1 order by a;
alter table t1 rename column f to new_f,  algorithm=copy;
alter table t1 convert to character set 'utf8',  algorithm=copy;
alter table t1 default character set 'utf8',  algorithm=copy;
alter table t1 default collate 'utf8_icelandic_ci',  algorithm=copy;
alter table t1 drop column new_f ,drop column g, drop column h,  algorithm=instant;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=instant;
alter table t1  partition  by hash(b) partitions 8;
alter table t1  remove partitioning;
alter table t1 drop column f ,drop column g, drop column h,  algorithm=instant;
# show binlog and clear status
connection slave;
reset master;
connection master;
connection master;
drop table t1, a1;
drop temporary table tmp_tbl;
connection slave;
include/stop_slave.inc
set global slave_parallel_threads = 0;;
set global slave_parallel_mode = optimistic;;
set global gtid_strict_mode = 0;;
include/start_slave.inc
connection slave;
stop slave;
change master to master_use_gtid= current_pos;
Warnings:
Warning	1287	'master_use_gtid=current_pos' is deprecated and will be removed in a future release. Please use master_demote_to_slave=1 instead
SET GLOBAL slave_parallel_threads=4;
set global slave_parallel_mode=optimistic;
set global gtid_strict_mode=1;
start slave;
connection master;
set binlog_alter_two_phase=true;
create table t1(a int , b int) engine=innodb;
create table a1(a int , b int) engine=myisam;
create temporary table tmp_tbl(a int, b int) engine=innodb;
alter table t1 add column if not exists c int ,  algorithm=nocopy;
alter table t1 add column d int first,  algorithm=nocopy;
alter table t1 add column e int after c,  algorithm=nocopy;
alter table t1 add column f int after c,  add column g int first ,add column  h char, algorithm=nocopy;
alter table t1 drop column c, drop column d, drop column e, drop column f, drop column g , drop column h,  algorithm=nocopy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f int after b,  add column g int first ,add column  h varchar(100), algorithm=nocopy;
alter table t1 add index if not exists index_1(f),  algorithm=nocopy;
alter table t1 drop index index_1,  algorithm=nocopy;
alter table t1 add unique key unique_1(g),  algorithm=nocopy;
alter table t1 drop index unique_1,  algorithm=nocopy;
alter table t1 add fulltext  key f_1(h),  algorithm=nocopy;
alter table t1  drop column f, drop column g ,  algorithm=nocopy;
alter table t1 add primary key(h),  algorithm=copy;
alter table t1 drop primary key,  algorithm=copy;
alter table t1  drop column h,  algorithm=copy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b, add column g varchar(100) first ,add column  h char,  algorithm=nocopy;
alter table t1 add period for system_time(f,h);
alter table t1 add system versioning;
alter table t1 drop system versioning;
alter table t1  drop column f, drop column g , drop column h,  algorithm=nocopy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=nocopy ;;
alter table t1 alter column f set default "****",  algorithm=nocopy ;;
alter table t1 alter column f drop default,  algorithm=nocopy ;;
alter table t1 change column g new_g char,  algorithm=copy;;
alter table t1 modify column h varchar(100),  algorithm=copy;;
alter table t1 drop column new_g ,drop column f, drop column h,  algorithm=nocopy ;;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=nocopy;
alter table t1 add index if not exists index_1(f),  algorithm=nocopy;
alter table t1 disable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 enable keys,  algorithm=copy;
Warnings:
Note	1031	Storage engine InnoDB of the table `test`.`t1` doesn't have this option
alter table t1 rename t2,  algorithm=nocopy;
alter table t2 rename t1,  algorithm=nocopy;
alter table a1 order by a;
alter table t1 rename column f to new_f,  algorithm=copy;
alter table t1 convert to character set 'utf8',  algorithm=copy;
alter table t1 default character set 'utf8',  algorithm=copy;
alter table t1 default collate 'utf8_icelandic_ci',  algorithm=copy;
alter table t1 drop column new_f ,drop column g, drop column h,  algorithm=nocopy;
# show binlog and clear status
connection slave;
reset master;
connection master;
alter table t1 add column f varchar(100) after b,add column g varchar(100) first ,add column  h char,  algorithm=nocopy;
alter table t1  partition  by hash(b) partitions 8;
alter table t1  remove partitioning;
alter table t1 drop column f ,drop column g, drop column h,  algorithm=nocopy;
# show binlog and clear status
connection slave;
reset master;
connection master;
connection master;
drop table t1, a1;
drop temporary table tmp_tbl;
connection slave;
include/stop_slave.inc
set global slave_parallel_threads = 0;;
set global slave_parallel_mode = optimistic;;
set global gtid_strict_mode = 0;;
include/start_slave.inc
include/rpl_end.inc
